<!-- GROQ Node Configuration Template -->
<script type="text/html" data-template-name="groq">
    <!-- Form Row for Node Name -->
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Node Name">
    </div>
    
    <!-- Form Row for GROQ Configuration Selection -->
    <div class="form-row">
        <label for="node-input-groqConfig"><i class="fa fa-cog"></i> GROQ Configuration</label>
        <input type="text" id="node-input-groqConfig" placeholder="Select GROQ Configuration" />
    </div>
    
    <!-- Form Row for Model Selection -->
    <div class="form-row">
        <label for="node-input-model"><i class="fa fa-robot"></i> Model</label>
        <input type="text" id="node-input-model" placeholder="Ex: llama3-70b-8192, llama3-8b-8192">
        <small>Possible values: llama3-70b-8192, llama3-8b-8192, ...</small>
    </div>
    
    <!-- Form Row for Temperature Slider -->
    <div class="form-row">
        <label for="node-input-temperature"><i class="fa fa-sliders-h"></i> Temperature</label>
        <input type="range" id="node-input-temperature" min="0.01" max="2" step="0.01" value="1">
        <span id="node-input-temperature-value">1</span>
    </div>
    
    <!-- Form Row for Max Token Slider -->
    <div class="form-row">
        <label for="node-input-max_token"><i class="fa fa-sliders-h"></i> Max Token</label>
        <input type="range" id="node-input-max_token" placeholder="Max Token" min="1" max="8192" step="1" value="1024">
        <!-- Note: A corresponding <span> to display the value is missing -->
    </div>
    
    <!-- Form Row for System Role -->
    <div class="form-row">
        <label for="node-input-system"><i class="fa fa-user-shield"></i> System Role</label>
        <input type="text" id="node-input-system" placeholder="Define the system role">
    </div>
    
    <!-- Form Row for User Message -->
    <div class="form-row">
        <label for="node-input-user"><i class="fa fa-user"></i> User Message</label>
        <input type="text" id="node-input-user" placeholder="Write your message">
    </div>
</script>

<!-- GROQ Node Registration and Configuration -->
<script type="text/javascript">
    RED.nodes.registerType('groq', {
        category: 'function', // Places the node under the 'function' category in the palette
        color: '#a6bbcf', // Sets the node color in the palette
        defaults: {
            name: { value: "" }, // Default value for the node's name
            groqConfig: { type: "groq-config", required: true }, // Reference to the GROQ configuration node, marked as required
            model: { value: "llama3-8b-8192" }, // Default model value
            temperature: { value: 1 }, // Default temperature value
            max_token: { value: 100 }, // Default max_token value
            system: { value: "" }, // Default system role (empty)
            user: { value: "" } // Default user message (empty)
        },

        inputs: 1, // Number of inputs the node accepts
        outputs: 1, // Number of outputs the node provides
        icon: "file.png", // Icon displayed for the node in the palette
        label: function() {
            return this.name || "groq"; // Label displayed on the node, defaults to "groq" if no name is set
        },
        oneditprepare: function() {
            // Function called when the node's edit dialog is prepared
            
            // Handle Temperature Slider
            var temperatureSlider = $("#node-input-temperature"); // Select the temperature slider element
            var temperatureValue = $("#node-input-temperature-value"); // Select the span displaying the temperature value
            temperatureValue.text(temperatureSlider.val()); // Initialize the displayed temperature value
            
            // Update the displayed temperature value when the slider is moved
            temperatureSlider.on("input", function() {
                temperatureValue.text($(this).val());
            });
            
            // Handle Max Token Slider
            var maxTokenSlider = $("#node-input-max_token"); // Select the max_token slider element
            var maxTokenValue = $("#node-input-max_token-value"); // Attempt to select the span displaying the max_token value
            maxTokenValue.text(maxTokenSlider.val()); // Initialize the displayed max_token value
            
            // Update the displayed max_token value when the slider is moved
            maxTokenSlider.on("input", function() {
                maxTokenValue.text($(this).val());
            });
        }
    });
</script>

<!-- Styles for the GROQ Node Configuration Dialog -->
<style>
    /* Styles for each form row to provide spacing */
    .form-row {
        margin-bottom: 10px;
    }

    /* Styles for labels within form rows */
    .form-row label {
        display: block; /* Makes the label a block element */
        margin-bottom: 5px; /* Adds space below the label */
    }

    /* Styles for text, number, and password input fields */
    .form-row input[type="text"],
    .form-row input[type="number"],
    .form-row input[type="password"] {
        width: 100%; /* Makes the input field take up the full width */
        padding: 5px; /* Adds padding inside the input field */
        box-sizing: border-box; /* Ensures padding is included in the element's total width */
    }

    /* Styles for range (slider) input fields */
    .form-row input[type="range"] {
        width: 100%; /* Makes the slider take up the full width */
    }

    /* Styles for small helper text */
    .form-row small {
        display: block; /* Makes the small text a block element */
        color: #888; /* Sets the text color to a light gray */
        margin-top: 2px; /* Adds a small margin above the helper text */
    }

    /* Styles for span elements used to display slider values */
    .form-row span {
        display: block; /* Makes the span a block element */
        text-align: right; /* Aligns the text to the right */
        font-weight: bold; /* Makes the text bold */
    }
</style>
